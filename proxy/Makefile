# Generated by Mirage (Wed, 29 Apr 2015 16:07:53 GMT).

LIBS   = -pkgs lwt.syntax,mirage-clock-xen,mirage-console.xen,mirage-net-xen,mirage-types.lwt,mirage.runtime,tcpip.stack-direct
PKGS   = mirage-clock-xen mirage-console mirage-entropy-xen mirage-net-xen mirage-xen tcpip xen-evtchn xen-gnt xenstore
SYNTAX = -tags "syntax(camlp4o),annot,bin_annot,strict_sequence,principal"

SYNTAX += -tag-line "<static*.*>: -syntax(camlp4o)"

FLAGS  = -cflag -g -lflags -g,-linkpkg,-dontlink,unix

XENLIB = $(shell ocamlfind query mirage-xen)

BUILD  = ocamlbuild -use-ocamlfind $(LIBS) $(SYNTAX) $(FLAGS)
OPAM   = opam

export PKG_CONFIG_PATH=$(shell opam config var prefix)/lib/pkgconfig

export OPAMVERBOSE=1
export OPAMYES=1

.PHONY: all depend clean build main.native
all:: build

depend::
	$(OPAM) install $(PKGS) --verbose

main.native:
	$(BUILD) main.native

main.native.o:
	$(BUILD) main.native.o

build:: main.native.o
	pkg-config --print-errors --exists mirage-xen
	ld -d -static -nostdlib \
	  _build/main.native.o \
	  -L/home/vagrant/.opam/mirage/lib/tcpip -ltcpip_xen_stubs \
	  -L/home/vagrant/.opam/mirage/lib/io-page -lio_page_xen_stubs \
	  $$(pkg-config --static --libs mirage-xen) \
	  $(shell gcc -print-libgcc-file-name) \
	  -o mir-synjitsu.xen

clean::
	ocamlbuild -clean

-include Makefile.user
